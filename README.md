
                     ___eSDK_uc_plugin_lync 开源项目简介___


1 简介

1.1 背景

本系统版本重点解决eSpace UC对常见桌面办公协作应用（Lync、Outlook、Sametime、Notes）的预集成能力。 eSDK UC V100R003C01版本需要实现对Lync、Outlook、Sametime、Notes预集成功能，以满足客户需求，实现基于业务的协同办公和统一沟通。

1.2用户特征

见 2.2 系统上下文。

1.3假设和约束

1.3.1出口管制

本系统主要应用于国内和南美国家（巴西）客户企业办公环境，出口须遵循南美区国家相关准入标准。

1.3.2业务能力约束

本系统为UC的配套产品，功能受UC系统功能的限制，只能提供UC所开放出来的业务功能，对于UC无开放的业务功能，系统无法支持。 本系统是针对Microsoft Lync、Microsoft Outlook、IBM Lotus Sametime、IBM Lotus Notes产品的预集成，其中Lync、Sametime预集成插件界面风格继承于对应被集成产品界面框架，插件不具备兼容集成于其它产品的能力。 该插件不支持Lync呼叫服务器与eSpace呼叫服务器互通场景。

2系统概述

2.1 V/R版本描述

V100R003C01(UC) 版本新增如下特性： eSDK Lync预集成插件，支持Microsoft Lync version 2013； eSDK Outlook预集成插件，支持Microsoft Outlook version 2007/2010/2013； eSDK Sametime预集成插件，支持IBM Lotus Sametime (embedded or standalone) version 8.5.2 or higher。

3总体需求

3.1总体需求描述

3.1.1Microsoft Lync预集成需求

Microsoft Lync作为国外主流协作办公软件，其IPT能力较弱，eSDK通过封装我司eSpace产品语音服务，以预集成插件形式提供给客户直接安装使用，从而弥补Lync IPT能力不足。 eSDK Lync预集成插件系统需求如下： 表3 Microsoft Lync预集成功能需求列表 需求编号 需求名称 需求简要描述 备注 SR.LYNC.FUN.000 通讯录同步 eSpace UC与Lync通讯录信息同步，支持LDAP同步
SR.LYNC.FUN.001 启动与注销 扩展Lync工具选项菜单下拉项，提供启动和注销eSDK预集成插件功能命令菜单
SR.LYNC.FUN.002 上下文呼叫 扩展Lync联系人右键菜单项，提供上下文发起呼叫功能命令菜单
SR.LYNC.FUN.003 集成工具包 集成UC呼叫、拨号盘、历史记录、模式切换、选项设置等控件功能，以工具面板界面形态停驻在Lync窗口桌面
SR.LYNC.FUN.004 来电接收 呼叫来电时，提供来电弹出窗口。选择“接听”，通话建立；选择“拒绝”，通话请求中断
SR.LYNC.FUN.005 通话控制 通话建立时，提供集成通话窗口，窗口中集成常用呼叫控制功能，包括：挂断、保持、二次拨号、转移、视频、静音等
SR.LYNC.FUN.006 状态呈现 当前用户呼叫时，Lync主界面用户的Lync状态变成“正在通话中”状态； 当前用户进行IM会话时，如果对话方使用插件进行呼叫，IM窗口该联系人Lync状态变成“正在通话中”状态； 呼叫结束时，状态恢复成之前Lync状态。
SR.LYNC.FUN.007 历史记录管理 提供历史记录管理窗口，可以对查看当前用户本地呼叫、会议记录，并且能够维护记录条目，对记录再次进行呼叫/会议操作 SR.LYNC.DFX.001 国际化 支持中文、英文、葡萄牙语言环境
SR.LYNC.DFX.002 部署与安装 支持以Microsoft Installer configuration files (MSI files)的形式部署，能够通过第三方软件工具推送部署包；
SR.LYNC.DFX.003 故障诊断 支持定位诊断故障信息，提供故障解决方案；
SR.LYNC.DFX.004 版本支持 支持Lync2013版本
SR.LYNC.DFX.005 IM中断呼叫存活 当Lync的IM客户端和服务端失去连接时，插件的呼叫功能不受影响。 SR.LYNC.DFX.006 性能属性 1、插件占用资源不能太大，具体多少？ 2、插件运行不能明确影响Lync本身功能和性能； 3、网络正常的情况下，通过插件发起呼叫操作延迟不超过1秒
 具体需求描述可参见《eSDK Solution V100R003C01(UC) 系统需求清单.docx》。 总体需求用例描述如下：

图2 Lync预集成插件总体需求用例 3.2功能实现方案 3.2.1总体逻辑架构

图3 Microsoft Lync预集成插件逻辑结构视图 eSDK Lync预集成插件设计采用分层设计原则，以MVC（MODEL/VIEW/CONTROL）模型为基础，在逻辑上划分为UI层（集成界面）、业务组件层（插件业务模块）、UC服务层（UC SDK），各层之间提供API进行内部交互。各层主要功能如下： UI层：主要处理插件界面显示，完成与用户的人机交互。界面通过扩展Lync SDK，或者采用WPF机制包装Lync进程实现，具体技术参见7.3 Lync SDK界面扩展技术。 业务组件层：处理插件功能模块的业务逻辑。响应UI传过来的业务请求，根据请求业务逻辑调用UC SDK API，获取UC服务能力(用户鉴权、语音、视频呼叫、历史记录管理、通讯录、状态呈现等)。 UC服务层：开放UC SDK封装的UC服务能力。UC SDK实现对媒体、信令、协议等各种能力的统一API接口封装。

3.2.2业务接口说明 表4 Microsoft Lync预集成插件逻辑模块之间的接口 接口序号 接口类型 接口描述 INF:a 预集成UI<->Lync SDK Lync SDK界面扩展接口，插件界面通过继承扩展Lync SDK的UI框架实现 INF:b 业务组件<->UC SDK UC服务接口，主要提供登录鉴权、语音、视频呼叫、会议、通讯录、历史记录管理、状态呈现等核心UC服务 INF:1 集成界面<->业务组件 插件管理模块业务接口，提供插件登录、注销、特征属性配置、运行管理等 INF:2 集成界面<->业务组件 呼叫管理模块业务接口，提供呼叫控制、创建语音/视频呼叫、即时会议、拨号呼叫、呼叫来电业务等 INF:3 集成界面<->业务组件 历史记录管理业务接口，提供本地呼叫、会议历史记录查询、删除等 INF:4 集成界面<->业务组件 通讯录搜索接口，提供通讯录联系人查询功能 INF:5 集成界面<->业务组件 电话状态呈现接口，提供UC呼叫时状态呈现功能 （注：表中接口序号在总体逻辑架构图中有标示）

4功能设计：Microsoft Lync预集成 4.1【SR.LYNC.FUN.000】通讯录同步 eSpace UC系统与Lync通讯录信息同步，当前UC已支持LDAP协议同步机制。 4.2【SR.LYNC.FUN.001】启动与注销 用户在Lync客户端中启动插件、注销插件。用户必须登录eSDK预集成插件，才能发出呼叫、开始会议呼叫或执行其他操作。要登录到插件，必须满足以下条件： 拥有Microsoft Lync用户帐户 拥有eSpace UC用户帐户 分配需求如下： 表5 【SR.LYNC.FUN.001】分配需求 SR编号 AR编号 AR名称 备注 SR.INTE.LYNC.001 AR.LYNC.SIGN.UI.001 Lync工具选项下拉菜单扩展项
AR.LYNC.SIGN.BUS.001 启动插件
AR.LYNC.SIGN.BUS.002 注销插件 

4.2.1【AR.LYNC.SIGN.UI.001】Lync工具选项下拉菜单扩展项 4.2.1.1简要说明 Lync主界面工具选项下拉菜单中提供“启动eSDK预集成插件”和“注销eSDK预集成插件”两个扩展菜单项。 4.2.1.2界面原型

图4 Lync工具选项下拉菜单扩展项界面原型

4.2.2【AR.LYNC.SIGN.BUS.001】启动插件 4.2.2.1简要说明 点击Lync主窗口工具选项菜单，在下拉菜单中选择“启动eSDK预集成插件”项，系统通过已配置的UC帐户信息进行插件登录。 说明：UC帐户信息的配置可在插件工具面板的选项设置窗口中进行配置。 4.2.2.2界面原型 插件启动时，工具面板登录过程进度条显示界面示意图如下：

图5 Lync预集成插件UC登录过程界面示意图

4.2.3【AR.LYNC.SIGN.BUS.002】注销插件 4.2.3.1简要说明 点击Lync主窗口工具选项菜单，在下拉菜单中选择“注销eSDK预集成插件”项，系统注销当前已登录插件的UC帐户。 4.3【SR.LYNC.FUN.002】上下文呼叫 扩展Lync联系人右键菜单项，提供上下文发起呼叫功能命令菜单，用户右键通讯录列表或IM对话窗中的联系人，选择弹出菜单呼叫项执行发起语音/视频呼叫命令。 分配需求如下： 表6 【SR.LYNC.FUN.002】分配需求 SR编号 AR编号 AR名称 备注 SR.INTE.LYNC.002 AR.LYNC.MENU.UI.001 上下文扩展菜单项
AR.LYNC.MENU.BUS.001 联系人右键菜单发起呼叫 

4.3.1【AR.LYNC.MENU.UI.001】上下文扩展菜单项 4.3.1.1简要说明 联系人右键菜单中提供“呼叫”和“开始视频呼叫”两个扩展菜单项。 4.3.1.2界面原型

图6 Lync联系人右键菜单扩展项界面原型 4.3.2【AR.LYNC.MENU.BUS.001】联系人右键菜单发起呼叫 4.3.2.1简要说明 右键单击Lync联系人列表或IM窗口中的联系人，从弹出菜单中选择“呼叫”或“开始视频呼叫”项，与该联系人建立起VoIP语音或视频通话。 4.3.2.2界面原型 以下是“呼叫”项二级菜单项界面示意图：

图7 Lync预集成插件右键菜单“呼叫”项二级菜单项界面示意图

4.4【SR.LYNC.FUN.003】集成工具包 集成UC呼叫、拨号盘、历史记录、模式切换、选项设置等控件功能，以工具面板界面形态停驻在Lync窗口桌面，用户可直接在面板中点击控件图标使用插件UC功能。 分配需求如下： 表7 【SR.LYNC.FUN.003】分配需求 SR编号 AR编号 AR名称 备注 SR.INTE.LYNC.003 AR.LYNC.TOOL.UI.001 插件工具面板
AR.LYNC.TOOL.UI.002 选项设置窗口
AR.LYNC.TOOL.BUS.001 拖放联系人呼叫
AR.LYNC.TOOL.BUS.002 查看对话历史记录
AR.LYNC.TOOL.BUS.003 切换软终端/桌面电话模式
AR.LYNC.TOOL.BUS.004 设置插件行为特征选项
AR.LYNC.TOOL.BUS.005 打开拨号盘拨号呼叫 AR.LYNC.TOOL.BUS.006 插件状态信息推送 

4.4.1【AR.LYNC.TOOL.UI.001】插件工具面板 4.4.1.1简要说明 提供一块独立于Lync界面的工具面板，面板中含有“呼叫”、“历史记录”、“电话模式”、“拨号盘”、“选项设置”功能图标控件，面板底部提供状态显示栏。 4.4.1.2界面原型

图8 Lync预集成插件工具面板界面原型 表8 Lync预集成插件工具面板控件图示说明 图示项 描述 区域 eSDK预集成插件工具面板。用户可以在面板中使用集成的UC功能 区域 呼叫区域。要发出呼叫或视频呼叫，在Lync窗口中选择一个联系人，然后将其拖到此区域电话图标按钮上（目前暂不支持拖放多个联系人发起多人呼叫功能） 区域 状态栏。位于工具面板窗格的底部，显示当前用户ID和插件发生了错误警示（区域出现“”图标） 历史记录控件。选择此按钮可以打开历史记录管理窗口，显示当前用户发起、接收和未接的所有呼叫以及参与的所有会议呼叫的列表。按钮上的数字表示新的未接呼叫的数量 电话呼叫模式切换控件。 •选择：表示从使用计算机进行电话呼叫切换为使用台式电话进行电话呼叫 •选择：表示从使用台式电话进行电话呼叫切换为计算机进行电话呼叫 选项设置控件。选择此按钮可以修改插件行为的某些特征 拨号盘控件。选择此按钮可以打开用来拨号的键盘 注：实际实现界面时，以上控件界面图标样式可自定义，不受上面图标形式约束。

4.4.2【AR.LYNC.TOOL.UI.002】选项设置窗口 4.4.2.1简要说明 提供一个可设置插件特征行为的窗口，窗口中包含常规选项、呼叫选项、语音选项和视频选项Tab子窗口。 4.4.2.2界面原型

图9 Lync预集成插件选项设置窗口界面原型 表9 Lync预集成插件选项设置项说明 类型 选项 描述 General UC登录帐户 设置登录插件的UC帐户名和密码信息，并提供随Lync自动启动可选项 Calls 呼出设备选项 设置插件默认呼出的设备类型，软终端 or IP电话 呼叫方式选项 设置使用插件发起呼叫的默认方式，语音 or 视频 呼叫转移选项 设置默认呼叫转移的号码对象 Audio 麦克风选项 设置语音通话的麦克风设备类型 扬声器选项 设置语音通话的扬声器设备类型 铃声选项 设置语音响铃文件 Video 摄像头选项 设置本地视频摄像头设备类型

4.4.3【AR.LYNC.TOOL.BUS.001】拖放联系人呼叫 4.4.3.1简要说明 将Lync联系人拖放至工具面板“呼叫”图标控件上发起呼叫。如果联系人在通讯录中有多个号码，则弹出一个对话框，从该对话框中选择要呼叫的号码。 注1：发起呼叫的模式（语音/视频）由选项设置中“设置默认发起呼叫方式”决定； 注2：当前该功能仅支持单一联系人拖放呼叫，不支持多个联系人拖放发起呼叫。

4.4.4【AR.LYNC.TOOL.BUS.002】查看对话历史记录 4.4.4.1简要说明 点击工具面板中的“历史记录”图标控件，打开一个新窗口，显示该用户本地所有呼叫、会议历史记录条目。

4.4.5【AR.LYNC.TOOL.BUS.003】切换软终端/桌面电话模式 4.4.5.1简要说明 点击工具面板中的“电话模式”图标控件，在软终端和台式电话之间切换呼出设备模式。 注1：“电话模式”控件为分软电话和台式电话两种图标，点击任一种图标控件，表示切换至该控件表示的模式，点击后该图标控件变灰不可操作； 注2：通话中是否支持电话模式切换

4.4.6【AR.LYNC.TOOL.BUS.004】设置插件行为特征选项 4.4.6.1简要说明 点击工具面板中的“选项设置”图标控件，打开一个新窗口，包含一些常规、呼叫、语音、视频选项特征设置。

4.4.7【AR.LYNC.TOOL.BUS.005】使用拨号盘拨号呼叫 4.4.7.1简要说明 点击工具面板中的“拨号盘”图标控件，控件右下侧弹出拨号盘，键入要呼叫的号码进行拨号呼叫。 4.4.7.2界面原型 拨号盘界面示意图如下：

图10 Lync预集成插件拨号盘界面示意图

4.4.8【AR.LYNC.TOOL.BUS.006】插件状态信息推送 4.4.8.1简要说明 后台将以下关于插件的状态指示推送至工具面板底部的状态栏中： (1)插件用户UC ID（插件启动结果状态的标识） (2)发生了错误

4.5【SR.LYNC.FUN.004】来电接收 呼叫来电时，弹出来电窗口。选择“应答”，通话建立；选择“拒绝”，通话请求中断。 分配需求如下： 表10 【SR.LYNC.FUN.004】分配需求 SR编号 AR编号 AR名称 备注 SR.INTE.LYNC.004 AR.LYNC.CALLREV.UI.001 呼叫来电窗口
AR.LYNC.CALLREV.BUS.001 呼叫来电业务 

4.5.1【AR.LYNC.CALLREV.UI.001】呼叫来电通知窗口 4.5.1.1简要说明 提供呼叫来电通知弹窗，窗口中能够显示来电方名片信息，并提供“接听”和“拒绝”两个选项操作按钮。 4.5.1.2界面原型

图11 Lync预集成插件呼叫来电弹窗界面原型 4.5.2【AR.LYNC.CALLREV.BUS.001】呼叫来电业务 4.5.2.1简要说明 呼叫来电时，弹出来电窗口；选择“接听”，通话建立；选择“拒绝”或关闭窗口，通话请求中断。 注：如果来电是视频呼叫，用户接听后，系统并不会自动开启被叫本地视频，被叫可在通话窗口呼叫控制工具栏中选择点击“开启视频”图标控件开启视频对话。 4.6【SR.LYNC.FUN.005】通话控制 通话建立时，显示集成通话窗口，集成常用呼叫控制功能，包括：挂断、保持、二次拨号、转移、视频、静音等。 分配需求如下： 表11 【SR.LYNC.FUN.005】分配需求 SR编号 AR编号 AR名称 备注 SR.INTE.LYNC.005 AR.LYNC.CALLCTRL.UI.001 通话窗口
AR.LYNC.CALLCTRL.UI.002 通讯录搜索窗口
AR.LYNC.CALLCTRL.UI.003 号码添加窗口
AR.LYNC.CALLCTRL.BUS.001 二次拨号
AR.LYNC.CALLCTRL.BUS.002 呼叫转移
AR.LYNC.CALLCTRL.BUS.003 通话保持/恢复 AR.LYNC.CALLCTRL.BUS.004 麦克风静音/恢复
AR.LYNC.CALLCTRL.BUS.005 结束通话
AR.LYNC.CALLCTRL.BUS.006 开启视频
AR.LYNC.CALLCTRL.BUS.007 邀请成员加入通话
AR.LYNC.CALLCTRL.BUS.008 将成员踢出通话
AR.LYNC.CALLCTRL.BUS.009 控制成员话语权 

4.6.1【AR.LYNC.CALLCTRL.UI.001】通话窗口 4.6.1.1简要说明 提供语音/视频通话窗口，主要包括对话成员名片(列表)、视频图像显示框、通话连接状态显示栏和呼叫控制图标控件（挂断/保持/麦克风/音量/摄像头/拨号盘/邀请成员等）。 说明： (1)P2P视频通话窗口：含视频图像显示框的通话窗口； (2)即时会议窗口：含多个对话人名片的通话窗口； (3)当前暂不实现多人视频通话功能。 4.6.1.2界面原型

图12 Lync预集成插件通话界面原型 表12 Lync预集成插件通话控制工具栏控件图示说明 图示项 描述 状态显示栏，显示当前通话连接状态以及通话时长 通话保持控件。点击该图标，当前通话被保持，再次点击，恢复通话 音量控制控件。点击图标，默认是静音，再次点击，取消静音；如果点击右侧，则打开一个游码条，可通过滑动游码调节本地扬声器或耳机设备输出音量大小 麦克风控制控件。点击图标，默认是麦克风静音，再次点击，取消静音；如果点击右侧，则打开一个游码条，可通过滑动游码调节麦克风输出音量大小 视频开启控件。选择此按钮可以开始在活动的呼叫中发送视频。在即时会议和视频通话窗口中，该图标控件呈灰色不可用状态。 拨号盘控件。点击该图标，打开拨号键盘，用于通话中二次拨号 挂断控件。点击该图标，挂断结束当前通话 呼叫选项下拉菜单控件（示意图见下面图17）。选择此向下箭头将打开一个下拉菜单，从中可以转移呼叫、保持或继续呼叫、终止呼叫、踢出通话、禁言/取消禁言、开启视频等 邀请成员控件。点击图标，默认打开通讯录搜索窗口，可以从通讯录中添加成员加入通话；如果点击右侧，则将打开一个下拉菜单，从中可以选择“从通讯录中邀请”或“直接从电话号码邀请” 注：实际实现界面时，以上控件界面图标样式可自定义，不受上面图标形式约束。 呼叫选项下拉菜单界面示意图如下：

图13 Lync预集成插件通话窗口呼叫选项下拉菜单界面示意图 4.6.2【AR.LYNC.CALLCTRL.UI.002】通讯录搜索窗口 4.6.2.1简要说明 提供通讯录搜索窗口，包含搜索栏、结果显示列表、邀请成员列表区域。 注：邀请成员加入通话时会打开通讯录搜索窗口，添加搜索到需要的联系人。 4.6.2.2界面原型

图14 Lync预集成插件通讯录搜索界面原型 4.6.3【AR.LYNC.CALLCTRL.UI.003】号码添加窗口 4.6.3.1简要说明 提供一个号码添加的弹窗，用于通过添加电话号码邀请加入通话，此功能支持添加通讯录外的联系人加入通话。 4.6.3.2界面原型

图15 Lync预集成插件号码添加窗口界面原型

4.6.4【AR.LYNC.CALLCTRL.BUS.001】二次拨号 4.6.4.1简要说明 通话时，点击通话窗口中的“拨号盘”图标控件，控件右下侧弹出拨号盘，可键入号码再次拨号。

4.6.5【AR.LYNC.CALLCTRL.BUS.002】呼叫转移 4.6.5.1简要说明 通话时，点击图标右侧的下拉箭头，弹出下拉菜单，选中“呼叫转移至...”菜单项，右侧扩展出该项二级菜单，列出了该用户好友联系人列表，再从中选择需要转移的联系人项，将当前通话转移至该联系人。 说明： (1)呼叫默认转移对象由选项设置中呼叫选项里的“设置默认呼叫转移”决定 (2)该功能仅针对被叫方使用，当用户为主叫方时，该功能不可用 (3)该功能仅支持P2P通话，不支持即时会议场景

4.6.6【AR.LYNC.CALLCTRL.BUS.003】通话保持/恢复 4.6.6.1简要说明 通话时，点击通话窗口中的“保持”图标控件，保持当前通话/恢复通话。

4.6.7【AR.LYNC.CALLCTRL.BUS.004】麦克风静音/恢复 4.6.7.1简要说明 通话时，点击通话窗口中的“麦克风”图标控件，对本地麦克风静音/取消静音。

4.6.8【AR.LYNC.CALLCTRL.BUS.005】结束通话 4.6.8.1简要说明 通话时，点击通话窗口中的“挂断”图标控件，或者点击呼叫上下文菜单图标，在弹出的菜单项中选择“结束呼叫”，或者直接关闭通话窗口，终止当前通话。

4.6.9【AR.LYNC.CALLCTRL.BUS.006】开启视频 4.6.9.1简要说明 通话时，点击通话窗口中的“视频”图标控件，或者点击呼叫上下文菜单图标，在弹出的菜单项中选择“开启视频”，开启本地视频摄像功能，当前语音通话升级为视频通话。

4.6.10【AR.LYNC.CALLCTRL.BUS.007】邀请成员加入通话 4.6.10.1简要说明 通话时，点击通话窗口中的“邀请成员”图标控件或者点击图标右侧的下拉箭头，在弹出下拉菜单中选择“从通讯录中邀请”，打开通讯录搜索窗口，在搜索栏中输入查找字段，向查找到需要邀请的联系人发起呼叫请求；或者点击图标右侧的下拉箭头，在弹出下拉菜单中选择“直接从电话号码邀请”，弹出一个号码添加窗口，输入电话号码后向该号码对象发起呼叫请求； 说明： (1)当前用户必须是通话发起方 (2)该功能支持邀请通讯录内部成员和通讯录外部成员加入通话两种场景 4.6.10.2界面原型 邀请成员加入通话界面示意图如下：

图16 Lync预集成插件通话窗口邀请成员加入通话界面示意图

4.6.11【AR.LYNC.CALLCTRL.BUS.008】将成员踢出通话 4.6.11.1简要说明 进行即时会议时，在对话成员列表某个与会联系人右侧点击呼叫选项下拉菜单，选择“踢出通话”项，将该与会人踢出会场。

4.6.12【AR.LYNC.CALLCTRL.BUS.009】控制成员话语权 4.6.12.1简要说明 进行即时会议时，在对话成员列表某个与会联系人右侧点击呼叫选项下拉菜单，选择“踢出通话”项，将该与会人踢出会场。

4.7【SR.LYNC.FUN.006】状态呈现 当前用户呼叫时，Lync主界面用户的Lync状态变成“正在通话中”状态； 当前用户进行IM会话时，如果对话方使用插件进行呼叫，IM窗口该联系人Lync状态变成“正在通话中”状态； 呼叫结束时，状态恢复成之前Lync状态。 分配需求如下： 表13 【SR.LYNC.FUN.006】分配需求 SR编号 AR编号 AR名称 备注 SR.LYNC.FUN.006 AR.LYNC.PRESENCE.UI.001 电话状态呈现界面控件
AR.LYNC.PRESENCE.BUS.001 IM对话方电话状态呈现
AR.LYNC.PRESENCE.BUS.002 当前用户电话状态呈现 

4.7.1【AR.LYNC.PRESENCE.UI.001】电话状态呈现界面控件 4.7.1.1简要说明 提供Lync主窗口用户和IM会话窗对话联系人UC电话状态界面呈现控件。 4.7.1.2界面原型

图17 Lync预集成插件电话状态呈现界面原型 4.7.2【AR.LYNC.PRESENCE.BUS.001】IM对话方电话状态呈现 4.7.2.1简要说明 IM对话方使用插件进行呼叫时，后台将该对话人“正在通话中”电话状态推送呈现在IM会话窗界面中，该对话人Lync自身IM状态显示变为UC呼叫状态显示；呼叫结束时，该对话人状态呈现还原为Lync自身IM状态显示。

4.7.3【AR.LYNC.PRESENCE.BUS.002】当前用户电话状态呈现 4.7.3.1简要说明 当前用户使用插件进行呼叫时，后台将该用户“正在通话中”电话状态推送呈现在Lync主窗口界面中，该用户Lync自身IM状态显示变为UC呼叫状态显示；呼叫结束时，该用户状态呈现还原为Lync自身IM状态显示。

4.8【SR.LYNC.FUN.007】历史记录管理 提供历史记录管理窗口，可以对查看当前用户本地呼叫、会议记录，并且能够维护记录条目，对记录再次进行呼叫/会议操作。 分配需求如下： 表14 【SR.LYNC.FUN.007】分配需求 SR编号 AR编号 AR名称 备注 SR.LYNC.FUN.007 AR.LYNC.HISTORY.UI.001 历史记录管理窗口
AR.LYNC.HISTORY.BUS.001 查询所有呼叫记录
AR.LYNC.HISTORY.BUS.002 删除呼叫记录条目
AR.LYNC.HISTORY.BUS.003 清空呼叫记录
AR.LYNC.HISTORY.BUS.004 对某条呼叫记录重新发起呼叫 AR.LYNC.HISTORY.BUS.005 查询所有会议记录
AR.LYNC.HISTORY.BUS.006 删除会议记录条目
AR.LYNC.HISTORY.BUS.007 清空会议记录
AR.LYNC.HISTORY.BUS.008 对某条会议记录重新发起即时会议
AR.LYNC.HISTORY.BUS.009 过滤时间搜索记录条目 

4.8.1【AR.LYNC.HISTORY.UI.001】历史记录管理窗口 4.8.1.1简要说明 提供一个历史记录管理窗口，窗口包含过滤时间搜索栏、呼叫历史记录、会议历史记录管理Tab子窗口。 4.8.1.2界面原型

图18 Lync预集成插件历史记录管理界面原型 4.8.2【AR.LYNC.HISTORY.BUS.001】查询所有呼叫记录 4.8.3【AR.LYNC.HISTORY.BUS.002】删除呼叫记录条目 4.8.4【AR.LYNC.HISTORY.BUS.003】清空呼叫记录 4.8.5【AR.LYNC.HISTORY.BUS.004】对某条呼叫记录重新发起呼叫 4.8.6【AR.LYNC.HISTORY.BUS.005】查询所有会议记录 4.8.7【AR.LYNC.HISTORY.BUS.006】删除会议记录条目 4.8.8【AR.LYNC.HISTORY.BUS.007】清空会议记录 4.8.9【AR.LYNC.HISTORY.BUS.008】对某条会议记录重新发起即时会议 4.8.10【AR.LYNC.HISTORY.BUS.009】过滤时间搜索记录条目

5编译指南 5.1依赖文件 5.1.1UCservice 插件 (lync 所依赖的UC库) 5.1.2lync插件 (lync插件源代码) 5.1.3self_dev (eSDK自研插件) 5.1.4open_src (合作方开源资源) 5.1.5third_party_groupware (微软平台所需资源) 5.1.6platform (华为UC&C产品线提供资源)

5.2层次关系 建立一个新文件夹，以github_lync_plugin为例，其中5.1.3—5.1.6 为同一级目录，属于github_lync_plugin文件夹下的一级目录；5.1.1—5.1.2属于同一级，新建一个子文件夹，以Source为例，将5.1.1—5.1.2 放置该目录下，该Source文件夹与上述5.1.3—5.1.6 文件夹并列。一级目录如下图所示：

二级文件夹Source目录如下图所示：

5.3编译顺序 5.3.1 打开UCService 文件夹，运行“0_拷贝依赖文件.bat”脚本，然后依次运行“1_Debug_全量编译全部.bat”和“2_Release_全量编译全部.bat”； 5.3.2 打开lync文件夹，运行“0_拷贝依赖文件.bat”脚本，然后依次运行“1_Debug_全量编译全部.bat”和“2_Release_全量编译全部.bat”； 5.3.3 上述两步操作若无错误，打开lync文件夹下的build文件夹，经过5.3.1和5.3.2 步骤会生成一个安装压缩文件，用于安装该插件。 5.4运行程序 用VS2010打开lync文件夹下的LyncWpfApp文件夹下的LyncWpfApp.sln，选用debug或release环境下运行源代码程序。
 
